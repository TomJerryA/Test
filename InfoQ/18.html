<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /></head><body><h3>ErLLVM——面向HiPE的LLVM后端</h3><p>High Performance Erlang（HiPE）是面向<a href="http://www.erlang.org/">Erlang</a>的一个高性能原生代码编译器，而ErLLVM项目就是为了给HiPE提供多后端支持而设计的。ErLLVM使用了LLVM基础架构。</p>
<p><a href="http://llvm.org/">LLVM</a>是一些模块化、可复用的编译器和工具链技术的集合，得到了Apple等公司的大力支持，比如目前Mac OS上默认的C/C++/Objective-C编译器Clang就是一个LLVM前端。为提高复用程度，LLVM采用了<a href="http://www.aosabook.org/llvm.html">分阶段的设计方式</a>。它将编译器分为前端、优化器和后端三个部分，定义好接口，然后分别设计应用于不同阶段的工具，这样对编程语言感兴趣的人就可以专注与前端，对优化感兴趣的人可以专注于中间的优化器部分，而对特定目标平台感兴趣的人只需要关注后端。ErLLVM正是利用了LLVM的这种优点，为多后端支持提供了方便。此外，LLVM的稳定性也早已得到社区的验证，所以HiPE可以可靠地依赖它。</p>
<p>ErLLVM目前支持AMD64和x86架构，对ARM的支持工作也正在进行之中。</p>
<p>下面我们简单地了解一下ErLLVM的架构。在采用LLVM之前，HiPE的架构如下图所示：</p>
<p><img src="http://infoqstatic.com/resource/news/2014/03/ErLLVM/zh/resources/0326000.png" width="600" _href="img://null" _p="true" alt="" /></p>
<p>Icode被翻译为RTL（“register-transfer language”，一种类RISC的底层汇编语言），然后从RTL生成面向具体平台的机器语言。而ErLLVM就是<a href="http://erllvm.softlab.ntua.gr/documentation/design/pipeline/">在RTL之后插入了LLVM后端</a>：</p>
<p><img src="http://infoqstatic.com/resource/news/2014/03/ErLLVM/zh/resources/0326001.png" width="600" _href="img://null" _p="true" alt="" /></p>
<p>RTL代码被翻译为LLVM汇编语言，翻译完成之后，生成的LLVM代码会被保存在一个文件中，之后就可以利用LLVM的工具链生成目标文件了。工具链的调用顺序可以用下图表示：</p>
<p><img src="http://infoqstatic.com/resource/news/2014/03/ErLLVM/zh/resources/0326002.png" _href="img://null" _p="true" alt="" /></p>
<p>ErLLVM的网站上提供了一份<a href="http://erllvm.softlab.ntua.gr/documentation/installation/">安装说明</a>，<a href="http://weibo.com/tchuba">@淘宝褚霸</a>也专门撰写了一篇<a href="http://blog.yufeng.info/archives/3104">博客</a>介绍ErLLVM的使用，感兴趣的读者可以参考。</p><br><br><br><br><br><br></body></html>