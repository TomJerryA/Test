<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /></head><body><h3>Powershell的期望状态配置支持推、拉模式</h3><p><a href="http://blogs.msdn.com/b/powershell/">Windows PowerShell博客</a>一直在写有关于PowerShell的期望状态配置（Desired State Configuration，DSC）的内容。DSC是Microsoft针对Windows世界计算机配置管理的提议。最新的一篇文章<a href="http://blogs.msdn.com/b/powershell/archive/2013/11/26/push-and-pull-configuration-modes.aspx">解释</a>了DSC是怎样支持推和拉两种配置模式的。</p>
<p>DSC是PowerShell工具中新增的内容，它让我们能够声明对于给定的节点或者机器什么是期望的配置。这种方式和PowerShell已经支持的命令式风格是不同的。利用DSC的脚本用户仅需要声明想要的配置，不需要关注为了配置一台机器需要执行哪些步骤。PowerShell 的DSC系统会决定应该如何做。</p>
<p>PowerShell DSC包含资源的概念。资源是允许配置项的构建块，例如：用户、组、服务器角色或者注册表项。PowerShell DSC已经有一些<a href="http://technet.microsoft.com/en-us/library/dn249921.aspx">内置</a>的资源，但是也能够<a href="http://technet.microsoft.com/en-us/library/dn249927.aspx">创建自定义</a>的资源。下面的示例使用<a href="http://technet.microsoft.com/en-us/library/dn282129.aspx">文件</a>资源声明了在本地主机上C:\inetpub\wwwroot文件夹中的内容应该完全复制于 C:\SiteFiles文件夹：</p>
<pre>
Configuration SiteConfig
{
   # A Configuration block can have zero or more Node blocks
   Node &quot;localhost&quot;
   {
      # File is a built-in resource you can use to manage files and directories
      # This example ensures files from the source directory are present in the 
destination directory
      File MyFileExample
      {
         Ensure = &quot;Present&quot;  # You can also set Ensure to &quot;Absent&quot;
         Type = &quot;Directory“ # Default is “File”
         Recurse = $true
         SourcePath = &quot;C:\SiteFiles&quot; # This is a path that has web files
         DestinationPath = &quot;C:\inetpub\wwwroot&quot; # The path where we want to ensure 
the web files are present
      }
   }
} </pre>
<p>为了应用一个配置，PowerShell提供了两种模式：推模式和拉模式。推模式是通过执行 Start-DscConfiguration 命令立即触发的。例如，下面的命令会将当前路径上的配置应用到脚本内部的所有指定节点上：</p>
<p>Start-DscConfiguration -Wait -Verbose -Path .</p>
<p>拉模式将主动权交给了节点本身。节点需要轮询一个拉服务器以便于查看是否有新的配置。如果检查到了新配置，那么本地配置管理器（Local Configuration Manager，LCM）——PowerShell DSC的引擎——就会下载并应用它们。拉模式的设置稍微有一点复杂：需要配置拉服务器和一个web网站，同时还需要通过<a href="http://technet.microsoft.com/en-us/library/dn521621.aspx">Set-DscLocalConfigurationManager</a> 命令在每一个目标节点上<a href="http://blogs.msdn.com/b/powershell/archive/2013/11/26/push-and-pull-configuration-modes.aspx">配置</a>一个LCM。 Windows PowerShell团队发布了一篇<a href="http://blogs.msdn.com/b/powershell/archive/2013/11/21/powershell-dsc-resource-for-configuring-pull-server-environment.aspx">文章</a>和一个帮助工具，以便于让用户能够更容易地设置拉服务器。</p>
<p>尽管大部分工具同时支持这两种模式，但是也有一些工具<a href="http://www.ansibleworks.com/wp-content/uploads/2013/05/AnsibleAgentless.pdf">喜好推模式</a>，例如<a href="http://www.ansibleworks.com/">Ansible</a>；还有一些工具<a href="http://docs.opscode.com/chef_overview_server.html">喜好拉模式</a>，例如<a href="http://puppetlabs.com/">Puppet</a>和<a href="http://www.getchef.com/">Chef</a>。有关于这两种模式的争论有很多。推模式更加简单、更容易控制：它不需要在目标节点上安装任何特定的软件，同时配置在用户请求时才会触发。拉模式的可伸缩性更好，支持丰富的元数据：目标节点自己完成配置工作，使用异步方式，同时拉服务器能够集中存储每一个目标节点状态的元数据。</p>
<p><b>查看英文原文</b>：<a href="http://www.infoq.com/news/2013/12/powershell-dsc-push-and-pull">Powershell's Desired State Configuration Supports Push And Pull Modes</a></p><br><br><br><br><br><br></body></html>