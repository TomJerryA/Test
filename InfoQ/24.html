<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /></head><body><h3>Entity Framework 6 Alpha 3为Code First提供对存储过程支持，并提供连接恢复功能</h3><p>Microsoft宣布<a href="http://blogs.msdn.com/b/adonet/archive/2013/02/27/ef6-alpha-3-available-on-nuget.aspx">Entity Framework 6 Alpha 3</a>已经可以下载了，它现在支持通过Fluent API将Code First映射到对应的新增、修改和删除功能的存储过程；添加了连接恢复功能；包含了来自iceclow和UnaiZorrilla的pull request内容；并添加了新的DbContext的API，以允许你管理自己的事务。</p> 
<p>根据Microsoft所说，这三种存储过程在创建时需要遵循类似于&lt;type_name&gt;<em>Insert，&lt;type_name&gt;</em>Update及&lt;type_name&gt;_Delete这样的格式。另外，方法的参数名称需要和属性名称相对应，新增和修改的存储过程需要为每个属性创建一个对应的参数，除了那些标记为ID（Identity）及计算所得的属性。而删除的存储过程则需要为实体（entity）的主键值创建一个对应的参数。<br /> 让我们看一看以下代码片段：</p> 
<pre>
public class Blog 
{ 
&nbsp;public int BlogId { get; set; } 
&nbsp;public string Name { get; set; } 
&nbsp;public string Url { get; set; } 
}</pre> 
<p>对应以上代码的新增存储过程看起来应该是以下这样：</p> 
<pre>
CREATE PROCEDURE [dbo].[Blog_Insert] 
&nbsp;@Name varchar(max), 
&nbsp;@Url varchar(max) 
AS 
&nbsp;INSERT INTO [dbo].[Blogs] ([Name], [Url])
&nbsp;VALUES (@Name, @Url)
&nbsp;SELECT SCOPE_IDENTITY() AS BlogId    </pre> 
<p>修改和删除的存储存储过程则按照如下方式编写：</p> 
<pre>
CREATE PROCEDURE [dbo].[Blog_Update] <br /> @BlogId int, 
&nbsp;@Name varchar(max), 
&nbsp;@Url varchar(max) 
AS 
&nbsp;UPDATE [dbo].[Blogs] &nbsp;&nbsp;SET [Name] = @Name, [Url] = @Url 
 WHERE BlogId = @BlogId;<br />
CREATE PROCEDURE [dbo].[Blog_Delete]
 @BlogId int    
AS
 DELETE FROM [dbo].[Blogs]
 WHERE BlogId = @BlogId    </pre> 
<p>官方<a href="http://entityframework.codeplex.com/wikipage?title=Code%20First%20Insert%2fUpdate%2fDelete%20Stored%20Procedure%20Mapping">文档</a>详细地介绍了所有可能的场景细节。</p> 
<p>Entity Framework 6 Alpha 3加入了<a href="http://entityframework.codeplex.com/wikipage?title=Connection%20Resiliency%20Spec">连接恢复</a>功能，能够从短暂的连接失败中自动恢复。它的实现使用了IExecutionStrategy接口，而在其中的具体实现又使用到了IRetriableExecutionDector及IRetryDelayStrategy接口。</p> 
<p>根据官方信息来源，Entity Framework将包含4个执行策略（Execution Strategy），分别为NonRetryingExecutionStrategy，DefaultSqlExecutionStrategy，ExecutionStrategy和SqlAzureExecutionStrategy。</p> 
<p>Entity Framework Alpha 3提供了一项功能，它是来自<a href="http://www.codeplex.com/site/users/view/iceclow">iceclow</a>提交的一个pull request，允许你创建定制化的数据迁移操作，并在一个定制化迁移SQL脚本生成器中处理这些操作。Microsoft ADO.NET Entity Framework的项目经理<a href="http://romiller.com/2013/02/27/ef6-writing-your-own-code-first-migration-operations/">Rowan Miller</a>已经通过相关的代码示例介绍了iceclow的实现方式。</p> 
<p>Alpha 3也允许你使用来自<a href="http://www.codeplex.com/site/users/view/UnaiZorrilla">UnaiZorrilla</a>所提交的pull request，它提供了一个可插式的复数化与单数化的服务。另一项所包含的功能是允许你通过使用DbContext.Database.UseTransaction及DbContext.Database.BeginTransaction API管理你自己的事务。</p> 
<p><strong>查看英文原文：</strong><a href="http://www.infoq.com/news/2013/03/ef-6-alpha-3;jsessionid=6214E797E39E1FBD8665DA477F311BCF">Entity Framework 6 Alpha 3 with Code First Stored Procedures and Connection Resiliency</a></p> 
<p id="lastElm"></p></body></html>