<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /></head><body><h3>超低数据传输量，服务器端动态扩展——Node.js开源游戏框架升级至0.3版</h3><p>在这个广大女性可以放假半天的特别节日里，网易杭州研究院的小伙子们没能休息，反而热火朝天的发布了GitHub上广受好评的<a href="https://github.com/NetEase/pomelo">Node.js游戏框架pomelo</a>的最新版本0.3版。</p> 
<p>如果你还不了解这款“柚子”框架，请参见InfoQ对框架作者，杭州网易研究院高级研究员谢骋超的专访： <a href="http://www.infoq.com/cn/news/2012/11/netease-nodejs-framework;jsessionid=CD342C36CE6B143CF7D3FD3CF28C2F89">网易NodeJS开源游戏框架pomelo访谈</a>，及他在InfoQ连载的“<a href="http://www.infoq.com/cn/master-nodejs;jsessionid=CD342C36CE6B143CF7D3FD3CF28C2F89">深入浅出node.js游戏服务器开发</a>”系列文章。</p> 
<p>值得一提的是谢骋超也是本届<a href="http://www.qconbeijing.com/">QCon北京2013大会</a>的受邀演讲嘉宾，将会在<a href="http://www.qconbeijing.com/track15.html">Node.js专题</a>中分享Pomelo框架的心得体会。</p> 
<p>下面让我们了解一下pomelo框架的更新内容：</p> 
<p>Pomelo 0.3版为移动端性能优化做了很多工作， 新协议的数据包压缩后的传输量仅为0.2版的20%， 并保留了0.2版基于socket.io的传输协议。socket.io对开发浏览器端器端的实时应用非常适合，而socket（websocket）、protobuf、二进制等协议则对移动端、桌面客户端的开发更具优势。pomelo对它们的同时支持使同时支持浏览器、移动、桌面客户端的高实时应用或游戏变得非常容易。下面让我们看看pomelo的新版本特性：</p> 
<p><strong>1. 新协议支持</strong></p> 
<p>0.3版Pomelo开始支持二进制协议，并支持对请求route的字典压缩和请求内容进行protobuf压缩。0.3版同时兼容以前版本基于socket.io的通讯协议。通过在应用中配置不同的connector component来实现协议的切换或共存。</p> 
<p>目前Pomelo服务器提供两类connector：sioconnector和hybridconnector，分别对于基于socket.io和二进制的通讯。</p> 
<p><strong>2. 动态服务器扩展</strong></p> 
<p>Pomelo 0.3版开始支持动态增加和移除服务器进程机制，并提供相应的命令行工具。每台新增的服务器都会连接到master服务器上进行注册。Master再将新服务器的信息广播给集群中的所有服务器进程。原有的服务器进程再对新增服务器事件进行响应。</p> 
<p>当一个服务器进程接收到一个新增服务器的消息后，会将该服务器信息保存到本地的app上下文中，之后可以通过app.getServers等系列方法查看到新服务器的信息，从而影响之后的消息路由。</p> 
<p>如果新加的服务器的类型之前尚未存在于app上下文中，Pomelo会尝试着为其创建对应的rpc代理对象。如果该类型服务器需要提供rpc服务，则需要在约定的目录（servers/server-type/remote/）下提供rpc服务代码。</p> 
<p>动态移除服务器进程的流程也与上面类似，当服务器断开与master的连接后，master会将该服务器的信息广播给其他进程，其他进程再进行相应处理。</p> 
<p><strong>3. 其他新特性</strong></p> 
<ul> 
 <li>servers.json配置文件的修改：随着Pomelo支持协议的增多，配置文件原先定义的wsPort（代表websocket port）已不适用，现调整为clientPort。</li> 
 <li>3.2 新增channel广播接口：ChannelService新增broadcast接口，适用于给全世界广播的场景。</li> 
 <li>新增session获取接口：LocalSessionService新增根据session id获取localSession接口get和根据user id获取localSession接口getByUid。</li> 
 <li>javascript客户端支持： 
  <ul> 
   <li>支持两类javascript客户端 --- socket.io与websocket：目前socket.io与websocket两套协议在javascript都有用武之地。socket.io的兼容好，可以适应各种浏览器，适合开发类似聊天室这样的高实时应用。websocket客户端则在数据压缩上做到了很多优化，大大减少了消息的传输量，适合开发基于HTML 5的游戏应用。</li> 
   <li>客户端javscript build系统：以前的pomelo-jsclient版本管理异常混乱， 经常将好几个文件复制到不同的项目各自修改。因此我们引入了component来管理js的库。 客户端js代码目前采用以component的形式统一管理与维护。</li> 
  </ul> </li> 
 <li>其它客户端支持： 
  <ul> 
   <li>提供新的C客户端，支持socket协议，基于libuv开发，提供了完整的数据与消息压缩， 支持cocos2d-x</li> 
   <li>其余客户端，如flash,android, ios, unity3d， 目前还只支持socket.io协议，后续会推出基于socket协议客户端</li> 
  </ul> </li> 
</ul> 
<p>关于pomelo此次升级的其他相关文章，可以参考该项目的GitHub页面：</p> 
<ul> 
 <li><a href="https://github.com/NetEase/pomelo/wiki/Pomelo-0.2%E5%88%B00.3%E5%8D%87%E7%BA%A7%E6%8C%87%E5%8D%97">Pomelo 0.2到0.3升级指南</a></li> 
 <li><a href="https://github.com/NetEase/pomelo/wiki/Pomelo-%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9%E5%8D%8F%E8%AE%AE">Pomelo 数据压缩协议</a></li> 
 <li><a href="https://github.com/NetEase/pomelo/wiki/Pomelo-%E9%80%9A%E8%AE%AF%E5%8D%8F%E8%AE%AE">网络通讯协议参考</a></li> 
</ul> 
<p id="lastElm"></p><br><br><br><br><br><br></body></html>