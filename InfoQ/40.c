<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /></head><body><h3>Facebook faz Mercurial ser mais r√°pido que o Git</h3><p>No in&iacute;cio deste ano, o Facebook publicou em seu blog de engenharia um texto intitulado <a href="https://code.facebook.com/posts/218678814984400/scaling-mercurial-at-facebook/">Escalando o Mercurial no Facebook</a>, explicando com eles est&atilde;o escalando o Mercurial como seu reposit&oacute;rio.</p>
<p>O Facebook armazena todos os seus c&oacute;digos em um &uacute;nico reposit&oacute;rio que h&aacute; dois anos foi baseado no subversion. Em vez de ter reposit&oacute;rios separados para diferentes projetos (e compartilha-los utilizando um reposit&oacute;rio bin&aacute;rio), toda a base de c&oacute;digos fica em um enorme reposit&oacute;rio.</p>
<p>Infelizmente para o Facebook, nem o git e nem o mercurial foram projetados para suportar em um &uacute;nico e enorme reposit&oacute;rio diversos projetos. Uma vez que o prop&oacute;sito de um sistema de controle de vers&atilde;o distribu&iacute;do &eacute; o de armazenar todo o hist&oacute;rico de atualiza&ccedil;&otilde;es, e se todos os projetos de uma empresa s&atilde;o armazenados em um &uacute;nico reposit&oacute;rio, o tamanho do reposit&oacute;rio junto com o hist&oacute;rico das atualiza&ccedil;&otilde;es pode se tornar proibitivo com o decorrer do tempo. Em compara&ccedil;&atilde;o, os controladores de vers&otilde;es centralizados CVS e o subversion s&atilde;o capazes de controlar em um &uacute;nico reposit&oacute;rio m&uacute;ltiplos projetos, porque os clientes podem checar a vers&atilde;o mais recente ou um subconjunto de um reposit&oacute;rio.</p>
<p>Embora o time do Facebook tenha considerado modificar o Git para suportar suas necessidades, a conclus&atilde;o foi que as API's do Mercurial s&atilde;o mais apropriadas para dar suporte aos seus requerimentos. (O Git tem uma bem definida estrutura de objetos podendo ser manipulados por ferramentas, em oposi&ccedil;&atilde;o ao Mercurial que possui API's que podem ser utilizadas por outros programas). Muitas mudan&ccedil;as foram feitas contribuindo com a evolu&ccedil;&atilde;o do projeto Mercurial, incluindo <a href="http://selenic.com/repo/hg/rev/0b03454abae7">novos algoritmos de gr&aacute;ficos</a> e <a href="http://selenic.com/repo/hg/rev/ddc0323db78b">reescrita de c&oacute;digo utilizando C</a>.</p>
<p>Duas espec&iacute;ficas altera&ccedil;&otilde;es habilitaram a utiliza&ccedil;&atilde;o do Mercurial pelo Facebook para suportar o tamanho do seu reposit&oacute;rio; modificando a situa&ccedil;&atilde;o das atualiza&ccedil;&otilde;es dos arquivos para verificar se ocorreram altera&ccedil;&otilde;es espec&iacute;ficas, ao contr&aacute;rio da mudan&ccedil;a de conte&uacute;do (atrav&eacute;s da liga&ccedil;&atilde;o com a lista de altera&ccedil;&otilde;es de arquivos do sistema operacional) e modificando a forma do chekout deixando-o mais leve sem ter que registar um hist&oacute;rico mais completo.</p>
<p>Normalmente, um sistema distribu&iacute;do de controle de vers&atilde;o gera um hash com base no conte&uacute;do dos seus dados, em vez das informa&ccedil;&otilde;es de data e hora. Como resultado, para verificar se um reposit&oacute;rio possui altera&ccedil;&otilde;es, uma computa&ccedil;&atilde;o ser&aacute; executada percorrendo-se arquivo por arquivo, calculando-se o hash de cada arquivo para determinar se seu conte&uacute;do possui altera&ccedil;&otilde;es. Pela limita&ccedil;&atilde;o de um conjunto de arquivos que devem ser verificados, o sistema operacional &eacute; informado sobre as altera&ccedil;&otilde;es desde a &uacute;ltima checagem, sendo que o tempo desta opera&ccedil;&atilde;o ser&aacute; proporcional ao n&uacute;mero de arquivos que sofreram altera&ccedil;&otilde;es em suas datas e horas, em vez de se percorrer toda a &aacute;rea de trabalho atual. O Git tenta reduzir este problema atrav&eacute;s da execu&ccedil;&atilde;o do lstat para obter informa&ccedil;&otilde;es espec&iacute;ficas sobre os arquivos, mas ainda percorre todos os arquivos do reposit&oacute;rio para determinar se foram alterados ou n&atilde;o. Pode-se optimizar o reposit&oacute;rio para permitir que o sistema operacional, se solicitado, informe somente os arquivos que foram alterados.</p>
<p>Outro problema que o Facebook tentou resolver foi o de minimizar a quantidade de dados necess&aacute;rios relacionados com as opera&ccedil;&otilde;es de acr&eacute;scimo de novos arquivos ou duplica&ccedil;&otilde;es. O armazenamento de todos os projetos em um mesmo reposit&oacute;rio faz com que seu tamanho fique proporcional ao volume de entradas dos hist&oacute;ricos que com o passar do tempo poder&aacute; gerar problemas de escalabilidade. Uma vez que o reposit&oacute;rio n&atilde;o &eacute; particionado eficazmente a solu&ccedil;&atilde;o foi o da leitura e carga da vers&atilde;o mais atual dos arquivos atrav&eacute;s do registro.</p>
<p>Isso permitiu aos desenvolvedores uma r&aacute;pida obten&ccedil;&atilde;o de um conjunto de arquivos (da mesma forma e desempenho do subversion e CVS) tamb&eacute;m podendo ocorrer uma intera&ccedil;&atilde;o atrav&eacute;s do registro das altera&ccedil;&otilde;es. Entretanto se vers&otilde;es mais antigas do reposit&oacute;rio (ou revis&otilde;es de arquivos) forem necess&aacute;rias, a c&oacute;pia local n&atilde;o vai possuir estas informa&ccedil;&otilde;es. (O Git fornece uma limitada op&ccedil;&atilde;o de c&oacute;pia que permite obter uma revis&atilde;o do reposit&oacute;rio mas sem acessar registros anteriores atrav&eacute;s de hist&oacute;rico).</p>
<p>Pela extens&atilde;o das APIs do Mercurial, objetos atualizados que foram esquecidos podem gerar uma falha e serem baixados atrav&eacute;s de um servidor remoto quando solicitados. Obviamente se o servidor estiver por algum motivo indispon&iacute;vel, os desenvolvedores n&atilde;o poder&atilde;o solicitar vers&otilde;es antigas dos c&oacute;digos; mas uma vez que os registros de atualiza&ccedil;&otilde;es estejam dispon&iacute;veis novas atualiza&ccedil;&otilde;es podem ser criadas e enviadas para o servidor. (Em compara&ccedil;&atilde;o, o git mantem uma copia limitada das atualiza&ccedil;&otilde;es servindo apenas para fins de leitura).</p>
<p>Estas melhorias, juntamente com uma camada de mem&oacute;ria de armazenamento e compartilhamento, t&ecirc;m acelerado o uso do Mercurial pelo Facebook superando o Git tanto em acr&eacute;scimos de arquivos quanto em duplica&ccedil;&otilde;es em um fator estimado de 5 vezes. Ambas as avalia&ccedil;&otilde;es est&atilde;o dispon&iacute;veis nos reposit&oacute;rios mercurial do Facebook atrav&eacute;s de <a href="https://bitbucket.org/facebook/remotefilelog">remotefilelog</a> e <a href="https://bitbucket.org/facebook/hgwatchman">hgwatchman</a>. Embora estas configura&ccedil;&otilde;es e abordagens sejam especificas e em muitos casos n&atilde;o adequados a todos os usu&aacute;rios do Mercurial, fornece aos DVCS um inicio de estudo comparativo em um mundo de c&oacute;digo aberto cada vez mais dominado pelo Git.</p><br><br><br><br><br><br></body></html>