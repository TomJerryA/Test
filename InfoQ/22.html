<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /></head><body><h3>在Android上使用Facebook Concel对文件加密</h3><p>Facebook将它的<a href="http://facebook.github.io/conceal/">Conceal</a>转为开源项目。Conceal是一套用于Android上的文件加密和鉴权的Java API，它使用<a href="http://www.openssl.org/">OpenSSL</a>算法的子集以及一些预先定义的选项，以便让库保持在较小的体积——目前仅有85KB大小。</p>
<p>对于比较古老的Android设备——从Froyo到Jelly Bean——据Facebook表示，该库在这些设备上的性能要优于Android提供的原生支持。</p>
<p><img src="http://infoqstatic.com/resource/news/2014/01/encrypt-android-conceal/zh/resources/0129000.png" width="600" _href="img://null" _p="true" alt="" /></p>
<p>上图中的基准测试，展示了在Galaxy Y终端上，对原生Android算法（ES-CTR-HMAC-SHA1）、Bouncycastle（(AES-GCM）和Concea进行对比的结果l。</p>
<p>Google在KitKat中引入了对OpenSSL的支持，但是其中使用的默认密码流则“表现差强人意”——<a href="http://facebook.github.io/conceal/faq/">在Facebook看来</a>，“当使用我们的密码流（参阅<a href="https://github.com/facebook/conceal/blob/master/java/com/facebook/crypto/streams/BetterCipherInputStream.java">BetterCipherInputStream.java</a>文件）来替换它时，将使得默认实现能够与Conceal相媲美。”</p>
<p>以下代码片段展现了如何使用Conceal对文件进行加密：</p>
<pre>
//使用秘钥链和原生库的默认实现，来创建一个新的加密对象
Crypto crypto = new Crypto(
  new SharedPrefsBackedKeyChain(context),
  new SystemNativeCryptoLibrary());

//检查加密功能是否可用
//如果Android没有正确载入库，则此步骤可能失败
if (!crypto.isAvailable()) {
  return;
}

OutputStream fileStream = new BufferedOutputStream(
  new FileOutputStream(file));

//创建输出流，当数据写入流的时候进行加密，并将加密后的数据输出到文件
OutputStream outputStream = crypto.getCipherOutputStream(
  fileStream,
  entity);

//将纯文本写入其中
outputStream.write(plainText);
outputStream.close();
</pre>
<p>Conceal可以用来加密大型文件，Facebook用它来加密手机/平板电脑SD卡中的数据和图片。</p>
<p>在<a href="https://github.com/facebook/conceal/tree/master/native/third-party/patches/">Conceal的GitHub页面</a>上，还提供了基于OpenSSL构建相似库的<a href="https://github.com/facebook/conceal/tree/master/native/third-party/patches/">指南</a>。</p>
<p><strong>查看英文原文：</strong><a href="http://www.infoq.com/news/2014/01/encrypt-android-conceal">Encrypting Files on Android with Facebook Conceal</a></p><br><br><br><br><br><br></body></html>