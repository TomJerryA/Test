<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /></head><body><h3>An√°lise do Livro LogStash: Gerenciamento de logs de forma simples</h3><p>James Turnbull argumenta de forma convincente pela utiliza&ccedil;&atilde;o do LogStash para centraliza&ccedil;&atilde;o de logs, explicando detalhes de sua implementa&ccedil;&atilde;o dentro do contexto de um projeto de tratamento de logs. O livro <a href="http://www.logstashbook.com/">The Logstash Book</a> defende a facilidade de ado&ccedil;&atilde;o e o n&iacute;vel de escalabilidade oferecidos. Turnbull falou sobre o livro no evento <a href="http://www.youtube.com/watch?v=Avz6NqZp7aw">Hangops</a> este ano e informou que:</p>
<blockquote> 
 <p>O livro foi projetado para pessoas que nunca tiveram contato com o LogStash: administradores de sistemas, desenvolvedores, equipes de DevOps, e o pessoal de opera&ccedil;&atilde;o.</p> 
</blockquote>
<h2>O Problema do excesso de simplifica&ccedil;&atilde;o do gerenciamento de log</h2>
<p>Turnbull trabalha na &aacute;rea da administra&ccedil;&atilde;o de sistemas e seguran&ccedil;a. Ele explica como o gerenciamento de log n&atilde;o &eacute; escal&aacute;vel nos ambientes computacionais. Geralmente o gerenciamento de log torna-se mais complexo a medida que os logs tornam-se mais importantes para as pessoas, ou seja, quando os problemas aparecem. Administradores frequentemente utilizam ferramentas cl&aacute;ssicas como cat, tail, sed awk, perl e grep para examinar os registros de log. O uso dessas ferramentas n&atilde;o escala para um n&uacute;mero maior de hosts e tipos variados de arquivos de log. Ap&oacute;s perceber o problema de escalabilidade, as equipes normalmente seguem para o modelo de gerenciamento de log centralizado utilizando ferramentas como <a href="http://www.rsyslog.com/">rsyslog</a> e <a href="http://www.balabit.com/network-security/syslog-ng">syslog-ng</a>.</p>
<p>Enquanto esse modelo trata o problema da escalabilidade, Turnbull explica que n&atilde;o resolve a quest&atilde;o do gerenciamento de log pois atualmente existem um vasto n&uacute;mero de tipos de eventos de log, formatos, fuzo hor&aacute;rios e basicamente a falta de um contexto de entendimento f&aacute;cil. Por fim, a equipe utilizar&aacute; em seus ambientes computacionais a tecnologia de tratamento de logs que possuir mais vantagens nos quesitos armazenamento, busca, filtros e similares. Infelizmente este caminho inclui um custo relativamente elevado. O <a href="http://logstash.net/">LogStash</a> salva o dia, tendo como caracter&iacute;sticas pouca resist&ecirc;ncia para sua ado&ccedil;&atilde;o e uma arquitetura completa projetada para atender os requisitos de escalabilidade para implanta&ccedil;&otilde;es de larga escala.</p>
<h2>Resumo da arquitetura do LogStash</h2>
<p>O LogStash oferece uma arquitetura que permite capturar, analisar e armazenar logs. Al&eacute;m disso, um dos principais casos de uso transversais para uma implementa&ccedil;&atilde;o de LogStash &eacute; permitir a visualiza&ccedil;&atilde;o e localiza&ccedil;&atilde;o de eventos de log gerenciados. Turnbull recomenda o <a href="http://kibana.org/">projeto open source Kibana</a> para localizar eventos. No inicio de maio, Jordan Sissel, criador do LogStash, comentou no Twitter sobre a &uacute;ltima vers&atilde;o do LogStash carregar o <a href="http://demo.kibana.org/">kibana3</a>: <strong>java -jar logstash.jar kibana</strong>. Tanto Turnbull como Sissel est&atilde;o escrevendo sobre o Kibana pois ele oferece uma interface amig&aacute;vel para localiza&ccedil;&atilde;o de eventos permitindo integra&ccedil;&atilde;o com o Elasticstorage, o motor de armazenamento do LogStash. A seguinte screenshot do Kibana foi tirada do cap&iacute;tulo 3 do livro do LogStash, al&eacute;m disso tamb&eacute;m &eacute; poss&iacute;vel ver uma <a href="http://demo.logstash.net/">demostra&ccedil;&atilde;o online</a>:</p>
<p><img src="http://www.infoq.com/resource/articles/review-the-logstash-book/pt/resources/9fig1small.jpg" alt="" _href="img://9fig1small.jpg" _p="true" /></p>
<div id="lowerFullwidthVCR"></div>
<p>Al&eacute;m da visualiza&ccedil;&atilde;o de logs, h&aacute; uma arquitetura de componentes que gerencia o fluxo dos logs de diferentes servidores atrav&eacute;s de um componente intermedi&aacute;rio e finalmente para um local de armazenamento. Turnbull leva os leitores para uma explora&ccedil;&atilde;o das configura&ccedil;&otilde;es de cada componente do LogStash, no qual utiliza o <a href="http://redis.io/">Redis</a> (banco de de dados n&atilde;o relacional open source do tipo chave-valor), para enfileirar os registros de log a fim de prepar&aacute;-los para a indexa&ccedil;&atilde;o. O seguinte diagrama do cap&iacute;tulo tr&ecirc;s exibe os tipos de componentes distintos da arquitetura: remetente (shipper), broker, indexador e o visualizador.</p>
<p><img src="http://www.infoq.com/resource/articles/review-the-logstash-book/pt/resources/2fig2.jpg" alt="" _href="img://2fig2.jpg" _p="true" /></p>
<p>No livro, Turnbull explora as tr&ecirc;s principais fun&ccedil;&otilde;es dentro de uma inst&acirc;ncia do LogStash: tratamento de eventos de entrada, filtro de dados dos eventos e apresenta&ccedil;&atilde;o dos eventos. Estas tr&ecirc;s fun&ccedil;&otilde;es do LogStash s&atilde;o executadas baseadas nas informa&ccedil;&otilde;es de configura&ccedil;&atilde;o armazenadas em simples arquivos de configura&ccedil;&atilde;o &quot;.conf&quot;. Os arquivos &quot;.conf&quot; possuem se&ccedil;&otilde;es para cada um dos tr&ecirc;s tipos diferentes de plugins que o LogStash utiliza: entrada, filtro e sa&iacute;da. Cada inst&acirc;ncia do LogStash &eacute; customizada para atender os requisitos do seu prop&oacute;sito dentro da arquitetura. Por exemplo, essa seguinte configura&ccedil;&atilde;o para um remente (contendo uma entrada e duas sa&iacute;das) vem do cap&iacute;tulo tr&ecirc;s do livro:</p>
<pre>
input {
  redis {
    host =&gt; &quot;10.0.0.1&quot;
    type =&gt; &quot;redis-input&quot;
    data_type =&gt; &quot;list&quot;
    key =&gt; &quot;logstash&quot;
  }
}

output {
  stdout {
    debug =&gt; true
  }

  elasticsearch {
    cluster =&gt; &quot;logstash&quot;
  }
}
</pre>
<h2>O LogStash se encaixa na cultura DevOps</h2>
<p>O LogStash &eacute; uma ferramenta open source feita para funcionar no ecossistema open source. Todas as ferramentas do ecossistema do LogStash s&atilde;o instal&aacute;veis, configur&aacute;veis e gerenci&aacute;veis por linha de comando, tornando-as ideal para automa&ccedil;&atilde;o. Ao longo do livro, Turnbull deixa claro que utilizar gerenciamento de configura&ccedil;&otilde;es automatizado para controlar a instala&ccedil;&atilde;o e configura&ccedil;&atilde;o de cada componente LogStash &eacute; a melhor escolha. Entretanto, esse assunto est&aacute; al&eacute;m do escopo do livro, ent&atilde;o o pr&oacute;ximo ponto interessante coberto pelo livro &eacute; instala&ccedil;&atilde;o e configura&ccedil;&atilde;o dos componentes do LogStash. Combinar o entendimento da instala&ccedil;&atilde;o e configura&ccedil;&atilde;o com a atividade de automa&ccedil;&atilde;o permite construir m&uacute;ltiplos ambiente de forma simples. O esfor&ccedil;o &eacute; m&iacute;nimo na montagem de ambientes para as diferentes fases do projeto, Q&amp;A, resolu&ccedil;&atilde;o de problemas e suporte a Entrega Continua (Continuous Delivery).</p>
<h2>Instalando o Java, LogStash, Redis e ElasticSearch</h2>
<p>Turnbull demonstra a simples instala&ccedil;&atilde;o passo-a-passo do LogStash e de seus componentes. Sissel fez dessa caracteristica um princ&iacute;pio no projeto do LogStash: &quot;Se um novo usu&aacute;rio tem dificuldades, &eacute; um bug&quot;. O LogStash depende do Java, podendo ser uma simples instala&ccedil;&atilde;o do OpenJDK. A maioria das distribui&ccedil;&otilde;es Linux possuem a OpenJDK dispon&iacute;vel em seus sistemas de gerenciamento de pacotes. Por exemplo, para realizar a instala&ccedil;&atilde;o da OpenJDK no Debian/Ubuntu basta o comando &quot;sudo apt-get install openjdk-7-jdk&quot; e no Red Hat/CentOS, &quot;sudo yum install java-1.7.0-openjdk&quot;. O LogStash &eacute; distribu&iacute;do em um &uacute;nico arquivo JAR, podendo ser baixado na <a href="http://logstash.net/">p&aacute;gina LogStash.net</a>. Os arquivos JAR e de configura&ccedil;&atilde;o especificados na linha de comando s&atilde;o todo o necess&aacute;rio para iniciar o LogStash na OpenJDK. Como a OpenJDK, a instala&ccedil;&atilde;o do Redis tamb&eacute;m &eacute; feita atrav&eacute;s do sistema de gerenciamento de pacotes, atrav&eacute;s do comando &quot;sudo apt-get install redis-server&quot; no Debian/Ubuntu e &quot;sudo yum install redis&quot; no Red Hat/CentOS. O Redis est&aacute; pronto para processar os eventos de log logo ap&oacute;s algumas poucas configura&ccedil;&otilde;es no arquivo &quot;/etc/redis/redis.conf&quot; e in&iacute;cio do servi&ccedil;o. Assim como o LogStash, o ElasticSearch tamb&eacute;m depende do Java e pode ser <a href="http://www.elasticsearch.org/download/">facilmente baixado</a> no formato .deb para o Debian/Ubuntu ou .rpm para Red Hat/CetOS. Tamb&eacute;m precisa de algumas poucas configura&ccedil;&otilde;es no arquivo &quot;/etc/elasticsearch/elasticsearch.yml&quot; e j&aacute; est&aacute; pronto para iniciar.</p>
<h2>Componentes do LogStash: Remetente, Broker e Indexador</h2>
<p>O livro aborda os tr&ecirc;s tipos de plugins do LogStash no contexto de seu uso com remetentes e indexadores. Turnbull mostra como utilizar os seguintes plugins de entrada com o LogStash: arquivo, stdin, syslog, lumberjack e redis. Para ambientes que o LogStash n&atilde;o pode ser instalado, h&aacute; outras maneiras de enviar eventos para o LogStash: syslog, Lumberjack, Beaver e Woodchuck. Al&eacute;m dos dois principais plugins de sa&iacute;da apresentados, Redis e ElasticSearch. Turnbull tamb&eacute;m apresenta outros plugins de sa&iacute;da que se integram com outros sistemas: Nagios, alertas de e-mail, mensagem instant&acirc;nea e StatsD/Graphite.</p>
<p>Os filtros apresentados no livro incluem: grok, date, grep, e multiline. Turnbull mostra como plugins de filtro podem melhorar a efici&ecirc;ncia do processamento de log de aplica&ccedil;&otilde;es Java e logs do Postfix. Em alguns casos os logs podem ser filtrados antes mesmo do LogStash receb&ecirc;-los como entrada. Por exemplo, o Apache Logging permite formatos customizados no formato JSON, podendo facilmente processar sem a necessidade de um plugin de filtro. O broker, no exemplo utilizando o Redis, gerencia o fluxo de eventos. O LogStash suporta outras tecnologias de filas: AMPQ e ZeroMQ. A inst&acirc;ncia do indexador do LogStash faz o roteamento para pesquisa e armazenamento.</p>
<h2>Escalando o LogStash</h2>
<p>Escalar o LogStash envolve tr&ecirc;s principais pontos: resili&ecirc;ncia, performance e integridade. O diagrama a seguir tirado do cap&iacute;tulo sete do livro, ilustra o processo de escala&ccedil;&atilde;o do Redis, LogStash e ElasticSearch:</p>
<p><img src="http://www.infoq.com/resource/articles/review-the-logstash-book/pt/resources/3fig3.jpg" alt="" _href="img://3fig3.jpg" _p="true" /></p>
<p>O LogStash n&atilde;o depende diretamente do Redis para se recuperar de falhas. Ao inv&eacute;s disso, ele envia eventos para uma das duas inst&acirc;ncias de Redis configuradas. Caso uma das inst&acirc;ncias selecionadas esteja indispon&iacute;vel no momento, o LogStash come&ccedil;a a enviar eventos para a outra inst&acirc;ncia de Redis configurada. Como indexador, o LogStash &eacute; facilmente escal&aacute;vel criando m&uacute;ltiplas inst&acirc;ncias que recebem constantemente eventos dos brokers dispon&iacute;veis e enviam mensagens ao ElasticSearch. Com essa arquitetura, os eventos est&atilde;o dispon&iacute;veis somente para um Broker de cada vez, n&atilde;o havendo mensagens duplicadas sendo entregues ao indexador do LogStash e para o ElasticSearch. O ElasticSearch se organiza em cluster sozinho ao ser instalado em v&aacute;rias inst&acirc;ncias e estas possuem configura&ccedil;&otilde;es em comum. Ele usa multicast, unicast, ou um plugin para EC2 para se organizar em cluster. Enquanto a rede permitir, os n&oacute;s do cluster se comunicam e come&ccedil;aram a dividir dados entre eles. A divis&atilde;o dos dados &eacute; feita automaticamente e foca em resili&ecirc;ncia e performance.</p>
<p>A <strong>InfoQ.com</strong> tamb&eacute;m entrevistou James Turnbull sobre o LogStash.</p>
<p><strong>InfoQ.com:</strong> Quais os benef&iacute;cios e desvantagens voc&ecirc; considera estarem agregados a um caso de sucesso que utiliza um sistema de tratamento de logs centralizado com o LogStash?</p>
<blockquote> 
 <p>Turnbull: Os benef&iacute;cios do LogStash s&atilde;o t&iacute;picos da maioria das ferramentas open source de gerenciamento de sistemas: baixo custo do sofware, c&oacute;digo aberto (que torn&aacute;-o extens&iacute;vel); possui desenvolvimento e corre&ccedil;&otilde;es r&aacute;pidas de bugs; uma comunidade incr&iacute;vel desenvolvendo novas solu&ccedil;&otilde;es e ajudando uns aos outros e a possibilidade de priorizar tarefas para resolver seu problema. As desvantagens tamb&eacute;m se equiparam com a maioria das ferramentas open source: sem suporte comercial, e nem tantas funcionalidades quanto uma alternativa comercial; tamb&eacute;m pode haver uma resist&ecirc;ncia para sua ades&atilde;o, tanto ligado &agrave;s habilidades necess&aacute;rias quanto na documenta&ccedil;&atilde;o dispon&iacute;vel (apesar de agora voc&ecirc; poder contar com um livro incr&iacute;vel!) para sua implanta&ccedil;&atilde;o.</p> 
</blockquote>
<p><strong>InfoQ.com:</strong> Por que uma equipe de DevOps escolheria utilizar as ferramentas fornecidas pelo LogStash ao inv&eacute;s de ferramentas comerciais como o Splunk?</p>
<blockquote> 
 <p>Turnbull: O principal motivador dessa escolha, pela equipe de DevOps, seria o custo. Enquanto o LogStash (e seu dashboard Kibana) n&atilde;o possuem as mesmas capacidades do Splunk (ainda), esse conjunto vem ganhando rapidamente novas funcionalidades. Enquanto isso o Splunk possui um pre&ccedil;o consider&aacute;vel agregado que muitas pequenas empresas n&atilde;o podem custear. &Eacute; importante salientar que enquanto o software for livre, ainda h&aacute; um custo de implementa&ccedil;&atilde;o que pode ou n&atilde;o ser comparado com os custos das ferramentas comerciais.</p> 
</blockquote>
<p><strong>InfoQ.com:</strong> Quais os usos mais simples e uteis para a atividade de tratamento de log? Caso sejam diferentes para equipes diferentes dentro de uma empresa, poderia descrever esta diferen&ccedil;a?</p>
<blockquote> 
 <p>Turnbull: Os melhores casos de uso para o tratamento de logs s&atilde;o resolu&ccedil;&atilde;o de problemas e monitora&ccedil;&atilde;o. Os dados de log da sua aplica&ccedil;&atilde;o s&atilde;o na maioria das vezes a melhor fonte de informa&ccedil;&atilde;o quando voc&ecirc; est&aacute; enfrentando um problema na sua infraestrutura. Os dados de log tamb&eacute;m representam uma excelente fonte de dados para monitora&ccedil;&atilde;o de estado e eventos da sua infraestrutura e na constru&ccedil;&atilde;o de m&eacute;tricas para medir a performance da sua aplica&ccedil;&atilde;o.</p> 
 <p>Dito isso, equipes distintas dentro de uma organiza&ccedil;&atilde;o podem ter interesses distintos para os casos de uso citados. Por exemplo, equipes operacionais focam em resolu&ccedil;&atilde;o de problemas e desempenho que os dados de log podem auxiliar. Desenvolvedores s&atilde;o bastante interessados em usar os dados de log para ajudar na procura e corre&ccedil;&atilde;o de bugs. Equipes de seguran&ccedil;a focam em identificar vulnerabilidades e incidentes de seguran&ccedil;a que os dados de log podem destacar.</p> 
</blockquote>
<h2>Sobre o Autor do livro:</h2>
<p><img src="http://www.infoq.com/resource/articles/review-the-logstash-book/pt/resources/James_Turnbull.jpg" vspace="3" hspace="3" align="left" alt="" _href="img://James_Turnbull .jpg" _p="true" /><strong>James Turnbull</strong> &eacute; autor de seis livros t&eacute;cnicos sobre software livre e um membro antigo da comunidade de sofware livre. Turnbull &eacute; autor do primeiro (e segundo!) livro sobre o Puppet e trabalha na Puppet Labs na &aacute;rea de Opera&ccedil;&otilde;es e Servi&ccedil;o Profissionais. <a href="http://www.jamesturnbull.net/">Turnbull</a> palestra regularmente em eventos como OSCON, Linux.conf.au, FOSDEM, OpenSourceBridge, DevOpsDays e muitos outros. Ele foi presidente da Linux Australia; membro do comit&ecirc; da Linux Victoria; tesoureiro da Linux.conf.au 2008 e trabalha para o comit&ecirc; da Linux.conf.au e OSCON.</p><br><br><br><br><br><br></body></html>