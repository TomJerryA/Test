<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8" /></head><body><h3>無料で使えるWindows Azure Webサイトはどこまで活用できるか</h3><p align="left"><a target="_blank" href="http://www.infoq.com/jp/articles/waw_1114;jsessionid=8184215316A396717F163F73ED0D34D2">前回</a>は、Windows Azure Webサイトの構成変更やログ出力設定、モードやスケールの変更方法について紹介した。最終回となる今回は、「無料モード」でWebサイトを活用する際の注意事項をまとめる。また、簡単なアクセステストを行って、実際にどの程度の利用に耐え得るのかを検証してみたい。</p><h2>「無料モード」の制限事項</h2><p>Webサイトの無料モードでは、文字通り無償でWebサイトを簡単に立ち上げることが可能である。一方、利用できるリソースには上限が設けられており、一部機能には制限もある。以下は、無料モードの制限事項である&nbsp;</p><ul> 
 <li>カスタムドメイン（独自ドメイン）が利用不可</li> 
 <li>最大サイト数は10サイトまで</li> 
 <li>利用できるストレージは1GBまで</li> 
 <li>送信データは1日あたり165MBまで（※１）</li> 
 <li>CPU時間は1日あたり60分まで、または、5分あたり2.5分まで（※２）</li> 
 <li>メモリ使用量は1時間あたり1024MBまで</li> 
 <li>インスタンスサイズを変更できない</li> 
 <li>１サイトあたり最大1インスタンスまで（※３）</li> 
 <li>MySQL DBは20MBまで（※４）</li> 
</ul><p align="left">&nbsp;</p><p align="left">※１．最も注意すべき制限は、送信データ量の上限である。「送信データ」とはWindows Azureのデータセンターから見た送信のことであり、Webサイトの閲覧などで生じるダウンロード側のデータ量である。</p><p align="left">※２．CPU時間はWebサイトが実際にCPUを使用した時間のことである。無料モードや共有モードでは、仮想マシンを他のWebサイトと共有するため特定のWebサイトがCPUを占有しないように制限が設けられている。</p><p align="left">※３．Webサイトをホストする仮想マシンインスタンスを増やすことでスケールアウトが可能となる。2012年12月21日のアップデートにより共有モードは最大6インスタンス、占有モードは最大10インスタンスと増加したが、無料モードでは実質的にスケールアウトができなくなった。</p><p align="left">※４．すべてのモードで共通であるが、MySQL DBは無料で利用できる容量が少ない。DBサイズが足りない場合は、Webサイトとは別に有料の<a target="_blank" href="https://www.cleardb.com/">ClearDB</a>を契約しておくか、SQL Azureなどの利用を検討する必要がある。</p><p align="left">上記にあげたリソースの制限事項はアカウント全体に適用される。無料モードで複数サイトを利用する場合は、それらのリソース使用量の累計で考える必要がある。</p><p align="left">次は、実際にリソースの上限がどのように効いてくるのか、簡単なアクセステストを行って確認してみたい。</p><h2>リソース使用状況の確認</h2><p>Webサイトにアクセスすると、共有インスタンス上のCPUやメモリなどのリソースが消費される。使用できるリソースに上限を設けることで、共有インスタンス上で稼働する他のWebサイトに長時間迷惑が掛からない仕組みになっている。 <br /> 既に作成したWebサイト（WordPress）に対して、簡単なアクセステストを行って各リソースの使用状況を確認する。</p><p align="left">以下は、Webサイトを立ち上げた直後のリソース使用状況である。メモリが使用されたことが分かるが、それ以外はほとんど使用されていない。&nbsp;<br /> <img alt="" _p="true" _href="img://101.jpg" src="/resource/articles/waw_1227/ja/resources/101.jpg;jsessionid=8184215316A396717F163F73ED0D34D2" /><br /> 図１：ダッシュボード画面でのリソース使用状況の確認</p><p align="left">次は、１時間放置した後のリソース使用状況である。 <br /> <img alt="" _p="true" _href="img://02.jpg" src="/resource/articles/waw_1227/ja/resources/02.jpg;jsessionid=8184215316A396717F163F73ED0D34D2" /><br /> 図２：Webサイト立ち上げから１時間放置後のリソース使用状況</p><p align="left">Webサイトへ数回しかアクセスしていないため、ほとんど値は変わっていないが、メモリ使用量が0MBになっている。これはメモリ使用量の計測値が１時間毎にリセットされるためである。リソースの種類によって、計測値がリセットされる間隔は異なる。</p><p align="left">次は、Webサイトのトップページに対して、5分間で500回のアクセスを行った結果である。&nbsp;<br /> <img alt="" _p="true" _href="img://03.jpg" src="/resource/articles/waw_1227/ja/resources/03.jpg;jsessionid=8184215316A396717F163F73ED0D34D2" /> <br /> 図３： 5分間で500回のアクセスを行った後のリソース使用状況</p><p align="left">5分あたりのCPU時間を示す値が大きくなっているが、上限には達するほどの負荷ではなかったことがわかる。1日あたりのCPU時間はほとんど消費していないため、CPU時間だけを考えると1日あたり数万アクセスにも耐えるようにみえる。 <br /> ※濃いグレーで表示される部分は、同じアカウントの別サイトやバックグラウンドでの消費量が含まれているため、上限に対する使用状況としては、これを見る必要がある。</p><p align="left">一方、送信データは43.78MBであり、1日あたりの上限である165MBの28%に達している。今回のアクセステストでは同じ画像を毎回ダウンロードしているが、多人数で画像などを参照するサイトでは更に送信データ量が増加するだろう。逆に、テキスト中心のサイトや少人数で利用するサイトでブラウザキャッシュが有効に作用すれば、送信データ量を抑えて多くのアクセスに耐えることもできる。</p><h2>リソースの使用量が上限を超えた場合</h2><p>更に、10分間で1000回のアクセスを行い、送信データ量の上限を超えるとどうなるのだろうか。&nbsp;<br /> <img alt="" _p="true" _href="img://04.jpg" src="/resource/articles/waw_1227/ja/resources/04.jpg;jsessionid=8184215316A396717F163F73ED0D34D2" /> <br /> 図４：送信データ量の上限を超えた結果</p><p>&nbsp;</p><p align="left"><img alt="" _p="true" _href="img://05.jpg" src="/resource/articles/waw_1227/ja/resources/05.jpg;jsessionid=8184215316A396717F163F73ED0D34D2" /><br /> 図５：上限を超えた状態でWebサイトにアクセスした際に表示される画面</p><p align="left">使用可能なリソースの上限を超えると、「This site is currently not available…」と表示されたページに飛ばされてしまう。こうなると累積がリセットされるまで、実際のサイトにアクセスすることができなくなってしまう。無料モードで複数サイトを利用している場合は、他のサイトにもアクセスできなくなる。</p><p align="left">以上のように無料モードでは使用できるリソースの上限、特に送信データ量について注意する必要がある。この制限はWebサイトのモードをアップグレードすることで解除できる。共有モードや占有モードでは、送信データ量は1月あたり5GBまで無料となり、以降は通常の従量課金と同様の課金（最初の10TB/月まで16.61円/GB）が行われる。</p><p align="left">※リソースの上限値や価格については今後変更される可能性があるため、利用する際には以下のページを確認してほしい。 <br /> <a target="_blank" href="https://www.windowsazure.com/ja-jp/pricing/details/">https://www.windowsazure.com/ja-jp/pricing/details/</a></p><h2>まとめ</h2><p>４回にわたりWindows Azure Webサイトの「無料モード」を中心に紹介してきた。無料モードでは、極端に負荷をかけるような使い方やデータ転送量の上限に達した場合、サイトが停止されてしまうため、利用できる場面は限られてくるだろう。 <br /> しかし、無料でWebサイトを素早く立ち上げることができ、メジャーなCMSなどのOSSが簡単に利用できるというメリットは非常に大きい。また、より上位のモードにシームレスにアップグレードできるという点も重要である。 <br /> 無料モードであっても試験的なWebサイトや開発で利用するだけでなく、少人数で使うWebアプリケーションや自分専用のWebサービスなど、様々な使い道があると思われる。 <br /> まずは、無料モードでスモールスタートし、必要なタイミングで共有モードにアップグレードすれば、非常に低いコストで独自ドメインの利用やスケールアウトを行うことが可能である。 <br /> 是非これを機会にWindows Azure Webサイトを積極的に活用してはいかがだろうか。</p><blockquote>
 ◆関連記事
 <br /> 
 <a rel="permalink" target="_blank" href="http://www.infoq.com/jp/articles/waw_0924;jsessionid=8184215316A396717F163F73ED0D34D2">無料で使えるWindows Azure Webサイトの新モードを試す<br /> </a>
 <a rel="permalink" target="_blank" href="http://www.infoq.com/jp/articles/waw_1107;jsessionid=8184215316A396717F163F73ED0D34D2">無料で使えるWindows Azure Webサイトの編集と展開</a>
 <br /> 
 <a rel="permalink" target="_blank" href="http://www.infoq.com/jp/articles/waw_1114;jsessionid=8184215316A396717F163F73ED0D34D2">無料で使えるWindows Azure Webサイトの構成変更</a>
 <br /> &nbsp;
</blockquote><div class="clearer-space"></div></body></html>